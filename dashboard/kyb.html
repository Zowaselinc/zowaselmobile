<!DOCTYPE html>
<html lang="en">
    <head>
    <script type="text/javascript"  src="../assets/js/accessauthentication_dashboard.js"></script>
	<!-- Meta -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, minimal-ui, viewport-fit=cover">
	<meta name="theme-color" content="#2196f3">
	<meta name="author" content="DexignZone" /> 
    <meta name="keywords" content="" /> 
    <meta name="robots" content="" /> 
	<meta name="description" content="Zowasel"/>
	<meta property="og:title" content="Zowasel" />
	<meta property="og:description" content="Zowasel" />
	<meta property="og:image" content="https://zowasel.com/images/logos/white%20logo.png"/>
	<meta name="format-detection" content="telephone=no">
	
    <!-- Favicons Icon -->
	<link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon.png" />
    
    <!-- Title -->
	<title>Zowasel Mobile Web</title>
	
	<!-- PWA Version -->
	<!-- <link rel="manifest" href="manifest.json"> -->

    <link rel="stylesheet" href="dist/css/dialog-mobile.css">
    <script src="dist/mcx-dialog.js"></script> 
    
    <!-- Stylesheets -->
	<link rel="stylesheet" href="../assets/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css">
    <link rel="stylesheet" href="../assets/vendor/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/style2.css">
    <link rel="stylesheet" type="text/css" href="../bypass.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&family=Roboto+Slab:wght@100;300;500;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
</head>   
<!-- <body class="bg-white"> -->
<body class="">
<div class="page-wraper">
    
    <!-- Header -->
    <header class="header">
        <div class="main-bar">
            <div class="container">
                <div class="header-content">
                    <div class="left-content">
                        <a href="javascript:void(0);" class="back-btn">
                            <svg width="18" height="18" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9.03033 0.46967C9.2966 0.735936 9.3208 1.1526 9.10295 1.44621L9.03033 1.53033L2.561 8L9.03033 14.4697C9.2966 14.7359 9.3208 15.1526 9.10295 15.4462L9.03033 15.5303C8.76406 15.7966 8.3474 15.8208 8.05379 15.6029L7.96967 15.5303L0.96967 8.53033C0.703403 8.26406 0.679197 7.8474 0.897052 7.55379L0.96967 7.46967L7.96967 0.46967C8.26256 0.176777 8.73744 0.176777 9.03033 0.46967Z" fill="#a19fa8"/>
							</svg>
                        </a>
                        <h5 class="mb-0 ms-2 text-white">Kyb Verification</h5>
                    </div>
                    <div class="mid-content">
                    </div>
                    <div class="right-content">
                        <button class="btn verificationStatus">Unverified</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->
    
    <!-- Preloader -->
	<!-- <div id="preloader">
		<div class="spinner"></div>
	</div> -->
    <!-- Preloader end-->
    
	<!-- Sidebar -->
    <!-- <div class="sidebar" id="sidebar">
		
    </div> -->
    <!-- Sidebar End -->
    
   
    <!-- Banner -->
	<!-- <div class="author-notification">
		<div class="container inner-wrapper">
			
				
		</div>
	</div> -->
    <!-- Banner End -->

    
    <!-- Page Content -->
    <div id="main" class="page-content bottom-content container">
       
       <div class="account-box">
           <div class="container">
               <div class="account-area">
    
                   <!-- ---------------------------- FORM SLIDE 1 ----------------------------- -->
                   <form class="form" id="uploadkybForm">

                       <p aria-hidden="true" id="required-description">
                           <span class="required"><strong>*</strong></span> Required field
                       </p>

                       <!-- FORM 1 -->
                       <div class="kybSlide1">
                            <label style="color:#2c2646d1;font-weight:700;">Tax ID</label>
                            <div class="mb-3 input-group">
                                <!-- <span class="input-group-text"><i class="fas fa-hashtag"></i></span> -->
                                <input type="text" required min="5" max="6" id="tax_id" class="form-control" />
                            </div>
                       </div>
                       <!-- FORM 1 -->

                       <!-- FORM 2 -->
                       <div class="form">
                           <div class="upload__box">
                               <div class="w-100 mb-3">
                                   <label for="exampleInputEmail1" class="form-label mb-0">Upload CAC<span class="required">*</span></label>
                                   <div class="upload__btn-box">
                                   <label class="upload__btn">
                                       <p style="margin:0px;padding-top:11px;color:#7e7e7e;" class="fw-bold">Upload image</p>
                                       <input type="file" id="cacimage" data-max_length="0" class="upload__inputfile_CAC" accept="image/png, image/jpg, image/jpeg">
                                   </label>
                                   </div>
                                   <div class="upload__img-wrap preview-CAC"></div>
                               </div>
                           </div>

                           <div class="upload__box">
                                <div class="w-100 mb-3">
                                    <label for="exampleInputEmail1" class="form-label mb-0">Upload Financial Statement<span class="required">*</span></label>
                                    <div class="upload__btn-box">
                                    <label class="upload__btn">
                                        <p style="margin:0px;padding-top:11px;color:#7e7e7e;" class="fw-bold">Upload image</p>
                                        <input type="file" id="finimage" data-max_length="0" class="upload__inputfile_financialStatement" accept="image/png, image/jpg, image/jpeg">
                                    </label>
                                    </div>
                                    <div class="upload__img-wrap preview-financialStatement"></div>
                                </div>
                            </div>

                            <div class="upload__box">
                                <div class="w-100 mb-3">
                                    <label for="exampleInputEmail1" class="form-label mb-0">Upload MOU<span class="required">*</span></label>
                                    <div class="upload__btn-box">
                                    <label class="upload__btn">
                                        <p style="margin:0px;padding-top:11px;color:#7e7e7e;" class="fw-bold">Upload image</p>
                                        <input type="file" id="mouimage" data-max_length="0" class="upload__inputfile_MOU" accept="image/png, image/jpg, image/jpeg">
                                    </label>
                                    </div>
                                    <div class="upload__img-wrap preview-MOU"></div>
                                </div>
                            </div>
                           
                       </div>
                       
                       <div id="form_slide2_response"></div>
                       
                       <div class="input-group d-flex justify-content-between">
                           <button type="submit" class="btn mt-2 btn-success w-100 btn-rounded">Submit</button>
                       </div>

                   </form>
                   <!-- ---------------------------- FORM SLIDE 1 ----------------------------- -->



               </div>
           </div>
       </div>
   </div>
   <!-- Page Content End-->



    <!-- ------------------------------- LOADER -------------------------------- -->
    <div class="loader">
        
    </div>
    <!-- ------------------------------- LOADER -------------------------------- -->


    <!-- ------------------------------- MODAL -------------------------------- -->
    <div class="mymodal">
        
    </div>
    <!-- ------------------------------- MODAL -------------------------------- -->


	
</div>  
<!--**********************************
    Scripts
    ***********************************-->
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../assets/vendor/swiper/swiper-bundle.min.js"></script><!-- Swiper -->
<script src="../assets/js/dz.carousel.js"></script><!-- Swiper -->
<script src="../assets/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script><!-- Swiper -->
<script src="../assets/js/settings.js"></script>
<script src="../assets/js/custom.js"></script>
<script src="../assets/js/modal.js"></script>
<script src="../assets/js/plugins/country-state-array.js"></script>
<script src="../assets/js/countrylist.js"></script>
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script src="../assets/lib/pulltorefresh.js"></script>
<script src="../assets/js/env.js"></script> 
<script src="../assets/js/dashboard.js"></script>



<script src="../index.js" defer></script>
<script>
    $(".stepper").TouchSpin();
    checkifKYBis_done();
</script>
<script>
    // sidemenu();
    // populateUserDetails();
    populateCountryList();
    // pageRestriction(); KYC RESTRICTION COMMENTED OUT
</script>

<script>
    $(document).ready(()=>{
        $('#uploadkybForm').submit(function(e){
            e.preventDefault();
            submitKYBVerification();
        })
        ImgUpload();
    })

   


    // <!-- ---------------------------- IMAGE UPLOAD ----------------------------- -->
    let cacFile, financialStatementFile, mouFile;
    let cacIDLink;
    function ImgUpload() {
        var imgWrap1 = "";
        var imgArray1 = [];

        var imgWrap2 = "";
        var imgArray2 = [];

        var imgWrap3 = "";
        var imgArray3 = [];

        // Onclick input of CAC
        $('.upload__inputfile_CAC').each(function () {
            $(this).on('change', function (e) {
                imgWrap1 = $(this).closest('.upload__box').find('.preview-CAC');
                var maxLength = $(this).attr('data-max_length');

                var files = e.target.files;
                var filesArr = Array.prototype.slice.call(files);
                var iterator = 0;
                filesArr.forEach(function (f, index) {

                    if (!f.type.match('image.*')) {
                        return;
                    }

                    if (imgArray1.length > maxLength) {
                        return false
                    } else {
                        var len = 0;
                        for (var i = 0; i < imgArray1.length; i++) {
                            if (imgArray1[i] !== undefined) {
                            len++;
                            }
                        }
                        if (len > maxLength) {
                            return false;
                        } else {
                            imgArray1.push(f);

                            console.log(imgArray1, " image Array");
                            cacFile = imgArray1;
                            var reader = new FileReader();
                            reader.onload = function (e) {
                            var html = "<div class='kyb_upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close1").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close1'></div></div></div>";
                            imgWrap1.append(html);
                            iterator++;
                            }
                            reader.readAsDataURL(f);
                        }
                    }
                });
            });
        });

        // Onclick input of Financial Statement
        $('.upload__inputfile_financialStatement').each(function () {
            $(this).on('change', function (e) {
                imgWrap2 = $(this).closest('.upload__box').find('.preview-financialStatement');
                var maxLength = $(this).attr('data-max_length');

                var files = e.target.files;
                var filesArr = Array.prototype.slice.call(files);
                var iterator = 0;
                filesArr.forEach(function (f, index) {

                    if (!f.type.match('image.*')) {
                        return;
                    }

                    if (imgArray2.length > maxLength) {
                        return false
                    } else {
                        var len = 0;
                        for (var i = 0; i < imgArray2.length; i++) {
                            if (imgArray2[i] !== undefined) {
                            len++;
                            }
                        }
                        if (len > maxLength) {
                            return false;
                        } else {
                            imgArray2.push(f);

                            console.log(imgArray2, " image Array 2");
                            financialStatementFile = imgArray2;
                            var reader = new FileReader();
                            reader.onload = function (e) {
                            var html = "<div class='kyb_upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close2").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close2'></div></div></div>";
                            imgWrap2.append(html);
                            iterator++;
                            }
                            reader.readAsDataURL(f);
                        }
                    }
                });
            });
        });

        // Onclick input of MOU
        $('.upload__inputfile_MOU').each(function () {
            $(this).on('change', function (e) {
                imgWrap3 = $(this).closest('.upload__box').find('.preview-MOU');
                var maxLength = $(this).attr('data-max_length');

                var files = e.target.files;
                var filesArr = Array.prototype.slice.call(files);
                var iterator = 0;
                filesArr.forEach(function (f, index) {

                    if (!f.type.match('image.*')) {
                        return;
                    }

                    if (imgArray3.length > maxLength) {
                        return false
                    } else {
                        var len = 0;
                        for (var i = 0; i < imgArray3.length; i++) {
                            if (imgArray3[i] !== undefined) {
                            len++;
                            }
                        }
                        if (len > maxLength) {
                            return false;
                        } else {
                            imgArray3.push(f);

                            console.log(imgArray3, " image Array 3");
                            mouFile = imgArray3;
                            var reader = new FileReader();
                            reader.onload = function (e) {
                            var html = "<div class='kyb_upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close3").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close3'></div></div></div>";
                            imgWrap3.append(html);
                            iterator++;
                            }
                            reader.readAsDataURL(f);
                        }
                    }
                });
            });
        });





        $('body').on('click', ".upload__img-close1", function (e) {
            var file = $(this).parent().data("file");
            for (var i = 0; i < imgArray1.length; i++) {
                if (imgArray1[i].name === file) {
                    imgArray1.splice(i, 1);
                    break;
                }
            }
            console.log(imgArray1, " image Array After Delete");
            $(this).parent().parent().remove();
        });

        $('body').on('click', ".upload__img-close2", function (e) {
            var file = $(this).parent().data("file");
            for (var i = 0; i < imgArray2.length; i++) {
                if (imgArray2[i].name === file) {
                    imgArray2.splice(i, 1);
                    break;
                }
            }
            console.log(imgArray2, " image Array After Delete");
            $(this).parent().parent().remove();
        });

        $('body').on('click', ".upload__img-close3", function (e) {
            var file = $(this).parent().data("file");
            for (var i = 0; i < imgArray3.length; i++) {
                if (imgArray3[i].name === file) {
                    imgArray3.splice(i, 1);
                    break;
                }
            }
            console.log(imgArray3, " image Array After Delete");
            $(this).parent().parent().remove();
        });
        
    }
    // <!-- ---------------------------- IMAGE UPLOAD ----------------------------- -->



    // <!-- ----------------------- SUBMIT KYB VERIFICATION ----------------------- -->
    function submitKYBVerification(){
        let cac_has_image = document.getElementsByClassName('preview-CAC')[0];
        let financialStatement_has_image = document.getElementsByClassName('preview-financialStatement')[0];
        let mou_has_image = document.getElementsByClassName('preview-MOU')[0];

        if(!cac_has_image.innerHTML){
            basicmodal("", "Upload CAC Document");
        }else if(!financialStatement_has_image.innerHTML){
            basicmodal("", "Upload Financial Statement Document");
        }else if(!mou_has_image.innerHTML){
            basicmodal("", "Upload MOU Document");
        }else{

            let tax_id = document.getElementById('tax_id');
            
            let user = localStorage.getItem('zowaselUser');
            user = JSON.parse(user);
            let userid = user.user.id;
            let company = user.user.company;
            
            let name = company.company_name;
            let address = company.company_address;
            let state = company.state;
            let country = company.country;
            let contact_person = company.contact_person;
            let phone = company.company_phone;
            let website = company.company_website;
            let email = company.company_email;
            
            if(!name || !address || !state || !country|| !contact_person || !phone || !email){
                mcxDialog.confirm("Update your company profile before proceeding \n Go to profile company details", {
                    sureBtnClick: function(){
                        // callback 
                        location.assign("/dashboard/editaccountdetails.html");
                    }
                });
            }else{
                
                console.log(cacFile, "cacFile");
                console.log(financialStatementFile, "financialStatementFile");
                console.log(mouFile, "mouFile");
                // <!-- ------------------------ PING IMAGE UPLOAD URL ------------------------ -->
                startPageLoader();
                let img1,img2,img3;

                console.log(cacFile[0], "yeye");
                var fd = new FormData();  
                // fd.append( 'file', input.files[0] );
                fd.append("image", cacFile[0]);
                fetch('https://filesapi.growsel.com/upload.php', {method: 'POST',body: fd}).then(response => response.json())
                .then(data => {
                    // console.log("Chima", data);
                    if(data.error == false){
                        img1 = data.data.imageLink;

                        fd = new FormData();
                        fd.append("image", financialStatementFile[0]);
                        fetch('https://filesapi.growsel.com/upload.php', {method: 'POST',body: fd}).then(response => response.json())
                        .then(data => {
                            // console.log("Chima", data);
                            if(data.error == false){
                                img2 = data.data.imageLink;

                                fd = new FormData();
                                fd.append("image", mouFile[0]);
                                fetch('https://filesapi.growsel.com/upload.php', {method: 'POST',body: fd}).then(response => response.json())
                                .then(data => {
                                    // console.log("Chima", data);
                                    if(data.error == false){
                                        img3 = data.data.imageLink;

                                        //Store form Data
                                        var formData = new FormData();
                                        formData.append("tax_id", tax_id.value);
                                        formData.append("name", name);
                                        formData.append("address", address);
                                        formData.append("state", state);
                                        formData.append("country", country);
                                        formData.append("contact_person", contact_person);
                                        formData.append("phone", phone);
                                        formData.append("website", website);
                                        formData.append("email", email);

                                        formData.append("cac", img1);
                                        formData.append("financial_statement", img2);
                                        formData.append("mou", img3);

                                        // console.log(tax_id.value+name+address+state+country+contact_person+phone+website+email, "formData");
                                        startPageLoader();
                                        var settings = {
                                            "url": `${liveMobileUrl}/account/kyb`,
                                            "method": "POST",
                                            "timeout": 3500,
                                            "headers": {
                                                // "Content-Type": "application/json",
                                                "authorization": localStorage.getItem('authToken')
                                            },
                                            "processData": false,
                                            "mimeType": "multipart/form-data",
                                            "contentType": false,
                                            "data": formData
                                        };

                                        $.ajax(settings).done(function (data, textStatus, jqXHR) {
                                            console.log(data);
                                            let response = JSON.parse(data);
                                            EndPageLoader();
                                            if(textStatus==="timeout") {
                                                basicmodal("", "Service timed out <br/>Check your internet connection");
                                                return true;
                                            }
                                            var statusCode = jqXHR.status;
                                            console.log(statusCode);
                                            if(statusCode==403){
                                                basicmodal("", "Session has ended, Login again");
                                                setTimeout(()=>{
                                                    logout();
                                                },3000)
                                                return true;
                                            }
                                            // console.log(data);
                                            if(response.error == true){
                                                // alert(response.message);
                                                responsemodal("erroricon.png", "Error", response.message);
                                            }else{
                                                responsemodal("successicon.png", "Success", response.message);
                                                setTimeout(()=>{
                                                    // $("#addInputForm")[0].reset();

                                                    // location.assign('editprofile.html?type=kyb');
                                                    location.assign('/dashboard/kybverification.html');
                                                },2000)
                                                
                                            }
                                        });
                                    }
                                })
                            }
                        })
                    }
                })

                
                //Store form Data
                // var formData = new FormData();

                // let cacFileType = cacFile[0].type;
                // let finFileType = financialStatementFile[0].type;
                // let mouFileType = mouFile[0].type;

                // formData.append("cac", cacFile[0], `cac${userid}.jpeg`);
                // formData.append("financial_statement", financialStatementFile[0], `financial_statement${userid}.jpeg`);
                // formData.append("mou", cacFile[0], `cac${userid}.jpeg`);

                // console.log(tax_id.value+name+address+state+country+contact_person+phone+website+email, "formData");
                // startPageLoader();
                // var settings = {
                //     "url": `${liveMobileUrl}/account/kyb`,
                //     "method": "POST",
                //     "timeout": 3500,
                //     "headers": {
                //         // "Content-Type": "application/json",
                //         "authorization": localStorage.getItem('authToken')
                //     },
                //     "processData": false,
                //     "mimeType": "multipart/form-data",
                //     "contentType": false,
                //     "data": formData
                // };

                // $.ajax(settings).done(function (data) {
                    // console.log(data);
                //     let response = JSON.parse(data);
                //     EndPageLoader();
                //     if(response.error == true){
                //         // alert(response.message);
                //         responsemodal("erroricon.png", "Error", response.message);
                //     }else{
                //         responsemodal("successicon.png", "Success", response.message);
                //         setTimeout(()=>{
                //             // $("#addInputForm")[0].reset();

                //             // location.assign('editprofile.html?type=kyb');
                //             location.assign('/dashboard/kybverification.html');
                //         },2000)
                        
                //     }
                // });

            }


        }

    }
    // <!-- ----------------------- SUBMIT KYB VERIFICATION ----------------------- -->
    


</script>

</body>
</html>